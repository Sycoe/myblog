为了实现history功能，我们首先需要定义一个结构体来存储命令，然后使用一个数组来存储最近执行的10条命令。接下来，我们将实现查看最近10条命令的功能，并处理无效的history编号。
以下是一个简单的实现：
```c
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#define MAX_HISTORY 10
#define MAX_CMD_LEN 100
typedef struct {
    int id;
    char cmd[MAX_CMD_LEN];
} Command;
Command history[MAX_HISTORY];
int history_count = 0;
void add_to_history(const char *cmd) {
    if (history_count < MAX_HISTORY) {
        history[history_count].id = history_count + 1;
        strncpy(history[history_count].cmd, cmd, MAX_CMD_LEN);
        history_count++;
    } else {
        // Shift the history and add the new command
        for (int i = 0; i < MAX_HISTORY - 1; i++) {
            history[i] = history[i + 1];
        }
        history[MAX_HISTORY - 1].id = history_count + 1;
        strncpy(history[MAX_HISTORY - 1].cmd, cmd, MAX_CMD_LEN);
    }
}
void show_history() {
    for (int i = 0; i < history_count; i++) {
        printf("%d: %s\n", history[i].id, history[i].cmd);
    }
}
int main() {
    char cmd[MAX_CMD_LEN];
    while (1) {
        printf("osh> ");
        if (fgets(cmd, sizeof(cmd), stdin) == NULL) {
            break;
        }
        cmd[strcspn(cmd, "\n")] = 0; // Remove newline character
        if (strcmp(cmd, "history") == 0) {
            show_history();
        } else {
            add_to_history(cmd);
            // Execute the command
        }
    }
    return 0;
}
```
在这个示例中，我们定义了一个`Command`结构体来存储命令的ID和命令字符串。我们使用一个`history`数组来存储最近执行的10条命令，并使用`history_count`来跟踪当前存储的命令数量。
我们还定义了`add_to_history`函数来添加新的命令到历史记录中，如果超过10条，则会将最早的命令移出数组。`show_history`函数用于打印当前的历史记录。
请注意，这个示例没有实现执行命令的功能，也没有处理无效的history编号。您需要添加额外的代码来处理这些情况。
