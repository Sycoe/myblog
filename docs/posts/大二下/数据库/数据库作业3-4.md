
## 第三章

```sql
-- 电影基础信息表
CREATE TABLE movies (
    movie_id INT PRIMARY KEY AUTO_INCREMENT,
    title VARCHAR(255),
    release_year INT,
    country VARCHAR(255)
);

-- 演员表
CREATE TABLE actors (
    actor_id INT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(255),
    gender VARCHAR(10)
);

-- 电影类型表
CREATE TABLE movie_genres (
    genre_id INT PRIMARY KEY AUTO_INCREMENT,
    movie_id INT,
    genre VARCHAR(50),
    FOREIGN KEY (movie_id) REFERENCES movies(movie_id)
);

-- 电影-演员关联表
CREATE TABLE movie_actors (
    movie_id INT,
    actor_id INT,
    FOREIGN KEY (movie_id) REFERENCES movies(movie_id),
    FOREIGN KEY (actor_id) REFERENCES actors(actor_id),
    PRIMARY KEY (movie_id, actor_id)
);

CREATE INDEX idx_actor_name ON actors (name);

-- 电影-演员关联表数据插入语句
-- 使用之前提供的数据插入语句
SELECT m.title
FROM movies m
INNER JOIN movie_actors ma ON m.movie_id = ma.movie_id
INNER JOIN actors a ON ma.actor_id = a.actor_id
INNER JOIN movie_genres mg ON m.movie_id = mg.movie_id
WHERE m.release_year = 2017
AND m.country = 'UK'
AND (mg.genre LIKE '%Detective%' OR mg.genre LIKE '%Romance%')
GROUP BY m.title
HAVING COUNT(DISTINCT CASE WHEN a.gender = 'Male' THEN ma.actor_id END) > 10;

```

## 第四章

```sql
-- 创建职工表

CREATE TABLE 职工(
职工号 INT PRIMARY KEY,
姓名 VARCHAR(50)，
年龄 INT，
职务 VARCHAR(50)，
工资 DECIMAL(10,2),
部门号INT
);
-- 创建部门表
CREATE TABLE 部门(
部门号 INT PRIMARY KEY,
名称 VARCHAR(50),
经理名 VARCHAR(50),
地址 VARCHAR(100),
电话号 VARCHAR(20)
);
--创建视图以满足功能(7)
CREATE VIEW 部门工资统计 AS SELECT 部门号，
MAX(工资) AS 最高工资,
MIN(工资) AS 最低工资,
AVG(工资)AS 平均工资
FROM 职工
GROUP BY 部门号;

--(1)授予用户王明对两个表的SELECT权限
GRANT SELECT ON 职工 TO 王明;
GRANT SELECT ON 部门 TO 王明;
--(2)授予用户李勇对两个表的INSERT和DELETE权限
GRANT INSERT.DELETE ON 职工 TO 李勇;
GRANT INSERT, DELETE ON 部门 TO 李勇;
--(3)每个职工只对自己的记录有SELECT权限
GRANT SELECT ON 职工 TO PUBLIC;
GRANT SELECT ON 职工 TO 用户名;
--(4)用户刘星对职工表有SELECT和UPDATE权限
GRANT SELECT, UPDATE (工资) ON 职工 TO 刘星;
--(5)用户张新具有修改表结构的权限
GRANT ALTER ON 职工 TO 张新;
GRANT ALTER ON 部门 TO 张新;
--(6)用户周平具有对两个表的所有权限，并具有授权的权限
GRANT ALL PRIVILEGES ON 职工 TO 周平 WITH GRANT OPTION;
GRANT ALL PRIVILEGES ON 部门 TO 周平 WITH GRANT OPTION;
--(7)授予用户杨兰对部门工资统计视图的SELECT权限，撤销用户杨兰对职工表的工资字段的SELECT权限
GRANT SELECT ON 部门工资统计 TO 杨兰;
REVOKE SELECT(工资) ON 职工 FROM 杨兰;

```
